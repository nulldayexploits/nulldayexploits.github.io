<?php include('template/top.php') ?>

    <?php 
          $t = mysqli_query($mysqli, "SELECT count(*) as total FROM tb_ttd");
          $hit = mysqli_fetch_array($t);

          $cek = mysqli_query($mysqli, "SELECT * FROM tb_ttd");
       
    if($_SESSION['hak_akses']<>"ADMIN"){
        echo "<script>alert('Anda Tidak Berhak Mengakses Data Tersebut');</script>";
        echo '<script language="javascript"> window.location.href = "'.$base_url_back.'/index.php" </script>';
    }

    ?>

<div id="dialog_konfirmasi_hapus" class="modal fade">
    <div class=" vertical-alignment-helper">
        <div class="modal-dialog vertical-align-center">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Hapus TTD</h4>
                </div>
                <div class="modal-body">
                    <p>Hapus TTD <label style="font-weight: 600;" id="proposal_judul_hapus"></label> <span class="fa fa-question-circle-o"></span></p>
                    <input type="hidden" id="proposal_hapus" value="">
                    <p class="text-xs-center">
                        <button type="button" class="btn btn-lg btn-secondary-outline" onclick="hapus_proposal()"><span class="fa fa-check-square-o"></span> Ya</button>
                        <button type="button" class="btn btn-lg btn-danger-outline" onclick="$(&#39;#dialog_konfirmasi_hapus&#39;).modal(&#39;hide&#39;)"><span class="fa fa-remove"></span> Tidak</button>
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

    <section class="mbr-section mbr-section-hero mbr-section-full mbr-after-navbar" id="header1-1" style="background-color: rgb(255, 255, 255);">
        <div class="mbr-table-cell">
            <div class="container-fluid">
                <div class="row">
                    <div class="mbr-section-full col-md-12 col-lg-11">
                        <h1 class="mbr-section-title display-1" style="padding-top: 90px;">Kelola TTD</h1>
                        
                        <div class="mbr-section-btn text-xs-center" style="margin-bottom: 5px;">
                            <div class="row">
                                <div class="col-xs-12 col-sm-6 col-md-4 col-lg-4"><a class="col-xs-12 btn btn-lg btn-success-outline" href="tambah_ttd.php">MEMBUAT TTD BARU <span class="fa fa-users"></span></a></div><div class="col-xs-12 col-sm-6 col-md-4 col-lg-4">
                                </div>
                            </div>        
                        </div>
                        <div class="mbr-section-nopadding">
                            <table class="table table-bordered table-inverse" id="data-table">
                                <thead>
                                    <tr>
                                        <th colspan="8"><div class="pull-left">Total Data: 
                                            <label id="total_data"><?php echo $hit['total'] ?></label>&nbsp;Data</div></th>
                                    </tr>
                                    <tr>
                                        <th class="numbering"><center>NO.</th>
                                        <th class="judul"><center>NAMA</th>
                                        <th class="hidden-lg-down"><center>JABATAN</th>
                                        <th class="option"><center>PILIHAN</th>
                                    </tr>
                                </thead>
                                <tbody>

                                <?php 
                                    $no=0;
                                    while( $data = mysqli_fetch_array($cek)){
                                    $no++;
                                ?>

                                    <tr>
                                        <td class="numbering text-xs-right" style="color: white;">
                                             <?php echo $no; ?>.
                                        </td>
                                        <td class="judul" title="<?php echo $data['nama']; ?>" style="color: white;">
                                            <?php echo $data['nama']; ?>
                                        </td>
                                        <td class="kategori hidden-lg-down" style="color: white;"><?php echo $data['jabatan']; ?></td>
                                        <td class="option">
                                            <a href="edit_ttd.php?id_user=<?php echo $data['id']; ?>" class="btn-white-outline" style="padding: 3px; padding-left: 8px; padding-right: 8px;" title="Ubah User"><span class="fa fa-pencil"></span></a>
                                            
                                            <button type="button" onclick="tampilan_hapus('<?php echo $data['id']?>', $(this))"  class="btn-danger-outline" style="padding: 3px; padding-left: 8px; padding-right: 8px;" title="Hapus User"><span class="fa fa-trash"></span></button>
                                        </td>
                                    </tr>


                                <?php } ?>

                                </tbody>
                                <!-- <tfoot>
                                    <tr>
                                        <td colspan="7" class="text-xs-right"> 
                                            <div class="pull-right input-group">
                                                <button type="button" id="sebelum" class="btn-white-outline" onclick="halaman_sebelum();"><span class="fa fa-backward"></span></button>
                                                Halaman <input type="text" class="text-xs-right" id="halaman" style="color: #222; padding: 4px; width: 50px; height: 25px;" value="1"> dari 
                                                <input type="text" class="text-xs-right " id="total_proposal" style="color: #222; padding: 4px; width: 50px; border: none; background-color: transparent; color: #fff;" value="0" readonly="">
                                                <button type="button" id="setelah" class="btn-white-outline" onclick="halaman_setelah();"><span class="fa fa-forward"></span></button>
                                            </div>
                                        </td>
                                    </tr>
                                </tfoot> -->
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
<div id="dialog_penjelasan" class="modal fade">
    <div class=" vertical-alignment-helper">
        <div class="modal-dialog vertical-align-center">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Penjelasan Evaluator Penilaian Proposal</h4>
                </div>
                <div class="modal-body">
                    <strong>Penjelasan Segmen 1</strong>
                    <div id="penjelasan1"></div>
                    <strong>Penjelasan Segmen 2</strong>
                    <div id="penjelasan2"></div>
                    <strong>Penjelasan Segmen 3</strong>
                    <div id="penjelasan3"></div>
                    <strong>Penjelasan Segmen 4</strong>
                    <div id="penjelasan4"></div>
                    <strong>Penjelasan Segmen 5</strong>
                    <div id="penjelasan5"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<?php 

    function TanggalIndo($date){
    
          $BulanIndo = array( 
                            "Januari", 
                            "Februari", 
                            "Maret", 
                            "April", 
                            "Mei", 
                            "Juni", 
                            "Juli", 
                            "Agustus", 
                            "September", 
                            "Oktober", 
                            "November", 
                            "Desember"
                            );

          $tahun = substr($date, 0, 4);
          $bulan = substr($date, 5, 2);
          $tgl   = substr($date, 8, 2);

          $result = $tgl . " " . $BulanIndo[(int)$bulan-1] . " ". $tahun;   
          return($result);
    
    }

    function tampilhari($date){
        $day = date('D', strtotime($date));
        switch($day){
        case 'Sun':
            $hari_ini = "Minggu";
        break;

        case 'Mon':         
            $hari_ini = "Senin";
        break;

        case 'Tue':
            $hari_ini = "Selasa";
        break;

        case 'Wed':
            $hari_ini = "Rabu";
        break;

        case 'Thu':
            $hari_ini = "Kamis";
        break;

        case 'Fri':
            $hari_ini = "Jumat";
        break;

        case 'Sat':
            $hari_ini = "Sabtu";
        break;
        
        default:
            $hari_ini = "Tidak di ketahui";     
        break;
        }

        return $hari_ini;
    }


    function kategori($val)
    {
        if($val == "16"){
            $res = "Pengentasan kemiskinan";
        }elseif($val == "17"){
            $res = "Pendidikan";
        }elseif($val == "18"){
            $res = "Kesehatan";
        }elseif($val == "19"){
            $res = "Ketahanan Pangan";
        }elseif($val == "20"){
            $res = "Pertumbuhan Ekonomi dan Kesempatan Kerja";
        }elseif($val == "21"){
            $res = "Pemberdayaan masyarakat";
        }elseif($val == "22"){
            $res = "Pelayanan Publik Responsif Gender";
        }elseif($val == "23"){
            $res = "Perlindungan dan Pelestarian Lingkungan Hidup";
        }elseif($val == "24"){
            $res = "Tata kelola Pemerintahan";
        }else{
            $res = "---s-s-s-";
        }

        return $res;
    }

?>
<script type="text/javascript">
    $(this).ready(function(){
        ambil_proposal(); 
        $('#halaman').keyup(function(){
            halaman = $(this).val();
            ganti_halaman(halaman);
        });
    });
    function open_penjelasan(id){
        console.log(id);
        $.ajax({
            type: "POST",
            url: 'https://sinovik.menpan.go.id/index.php/get_penjelasan_proposal',
            data: { proposal: id },
            dataType: 'json',
            error: function(E){ console.log(E); },
            success: function(S){
                $('#dialog_penjelasan').modal('show');
                $('#penjelasan1').empty().append(S.segmen1);
                $('#penjelasan2').empty().append(S.segmen2);
                $('#penjelasan3').empty().append(S.segmen3);
                $('#penjelasan4').empty().append(S.segmen4);
                $('#penjelasan5').empty().append(S.segmen5);
            }
        });
    }
    function halaman_sebelum() {
        halaman = parseInt($('#halaman').val()) - 1;
        ganti_halaman(halaman);
    }
    function halaman_setelah() {
        halaman = parseInt($('#halaman').val()) + 1;
        ganti_halaman(halaman);
    }
    function ganti_halaman(halaman) {
        total_page = $('#total_proposal').val();
        if(halaman<1){ halaman = 1; }
        if( halaman>total_page) { $('#halaman').val(total_page); }
        else{ $('#halaman').val(halaman); }
         ambil_proposal(); 
    }
    function tampilan_edit(proposal){
        $('#proposal_edit').val(proposal);
        $('#dialog_view').modal('show');
    }
    function tampilan_hapus(proposal, judul){
        $('#proposal_hapus').val(proposal);
        $('#proposal_judul_hapus').html(judul.parent().parent().find('td.judul').html());
        $('#dialog_konfirmasi_hapus').modal('show');
    }
    function hapus_proposal(){
        $.ajax({
            type: "GET",
            url: 'controller.php?page=hapus_ttd&action=delete',
            data: { id_data: $('#proposal_hapus').val() },
            dataType: 'html',
            error: function(E){ console.log(E); },
            success: function(S){
                $('#dialog_konfirmasi_hapus').modal('hide'); 
                if(S>0){ ambil_proposal(); }
                window.location.href="view_ttd.php";
            }
        });
    }
    function tampilan_perbaikan(proposal, judul){
        $('#proposal_repair').val(proposal);
        $('#proposal_judul_repair').html(judul.parent().parent().find('td.judul').html());
        $('#dialog_konfirmasi_perbaikan').modal('show');
    }
    function repair_proposal(){
        var formData = new FormData($('#form_perbaikan')[0]);
        $.ajax({
            type: "POST",
            url: 'https://sinovik.menpan.go.id/index.php/repair_proposal',
            dataType: 'html',
            async: 'true',
            beforeSend: function(){
                if( $('#upload_file_perbaikan').val()==""){
                    if(confirm('anda belum memilih file untuk diunggah sebagai catatan perbaikan, lanjutkan?')){
                        
                    }
                    else{
                        $('#upload_file_perbaikan').focus();
                        return false;
                    }
                }
            },
            data: formData,
            dataType: 'json',
            cache: false,
            contentType: false,
            processData: false,
            error: function(E){ console.log(E); },
            success: function(S){
                $('#dialog_konfirmasi_perbaikan').modal('hide'); 
                if(S>0){ ambil_proposal(); }
            }
        });
    }
    function tampilan_submit(proposal, judul){
        $('#proposal_submit').val(proposal);
        $('#proposal_judul_submit').html(judul.parent().parent().find('td.judul').html());
        $('#dialog_konfirmasi_submit').modal('show');
    }
    function submit_proposal(){
        $.ajax({
            type: "POST",
            url: 'https://sinovik.menpan.go.id/index.php/submit_proposal',
            data: { proposal: $('#proposal_submit').val() },
            dataType: 'html',
            error: function(E){ console.log(E); },
            success: function(S){
                $('#dialog_konfirmasi_submit').modal('hide'); 
                if(S>0){ ambil_proposal(); }
            }
        });
    }
    function pencarian_proposal() {
        $('#dialog_pencarian').modal('show');
    }
    function cari_proposal() {
        ambil_proposal();
        $('#dialog_pencarian').modal('hide');
    }
    function ambil_proposal(){
        $.ajax({
            type: 'POST',
            url: 'https://sinovik.menpan.go.id/index.php/data_proposal',
            data: {
                judul : $('#text_pencarian').val(),
                halaman : $('#halaman').val(),
                banyak : $('#show_view_button').html(),
                status : $('#filter_view_status_button').html(),
                kategori : $('#filter_view_button').html(),
            },
            dataType: 'json',
            error: function(E) {
                console.log('Pengambilan data gagal');
            },
            success: function(S) {
                $('#total_data').empty().append(S.total_data);
                $('#total_proposal').val(S.total);
                $('#data-table tbody').empty().append(S.data);
            }
        });
    }
</script>

<?php $tinggi = '610px'; include('template/bottom.php') ?>