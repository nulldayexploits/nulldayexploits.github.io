<?php include('template/top.php') ?>


    <?php 
          $cek = mysqli_query($mysqli, "SELECT * FROM tb_invoice WHERE id = '$_GET[id_user]'");
          $data = mysqli_fetch_array($cek);
    ?>

<link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.3.0/css/datepicker.css" rel="stylesheet" type="text/css" />
<script src="https://sinovik.menpan.go.id/library/ckeditor/ckeditor.js"></script>


<form action="" class="form-horizontal" method="post" accept-charset="utf-8">
<input type="hidden" name="CSRF_TOKEN" value="53bd213a1ba949757bff4637fb19f452" style="display:none;" />
    <section class="mbr-section mbr-section-hero mbr-section-full mbr-after-navbar" id="header1-1" style="background-color: rgb(255, 255, 255);">
        <div class="mbr-table-cell">
            <div class="container">
                <div class="row">
                    <div class="mbr-section col-md-10 col-md-offset-1 text-xs-center">
                        <h1 class="mbr-section-title display-1">Edit Invoice</h1>
                        <div class="mbr-section-text">
                            <input type="hidden" name="id" value="<?php echo $data['id']; ?>">
                            <div class='row'>
                                <div class="col-lg-12">
                                    <div class="form-group">
                                        <label class="form-control-static pull-left"> Nama Kegiatan</label>
                                        <input type="text" class="form-control" id="input_1" name="kegiatan" placeholder="Kegiatan" value="<?php echo $data['kegiatan']; ?>" required>
                                    </div>
                                </div>
                            </div>
                            <div class='row'>
                                <div class="col-lg-12">
                                    <div class="form-group">
                                        <label class="form-control-static pull-left"> Item</label>
                                        <input type="text" class="form-control" id="input_1" name="item" placeholder="Item" value="<?php echo $data['item']; ?>" required>
                                    </div>
                                </div>
                            </div>
                            <div class='row'>
                                <div class="col-lg-12">
                                    <div class="form-group">
                                        <label class="form-control-static pull-left"> Description</label> <br><br>
                                        <textarea name="description" id="input_3"><?php echo $data['description']; ?></textarea>

                                        <script>
                                            var editor = CKEDITOR.replace( 'input_3', {
                                                    height: 200,
                                                    wordcount: {
                                                        maxWordCount: 300,
                                                    },
                                                    title: 'Rich Text Editor'
                                                } );
                                            editor.on( 'change', function( evt ) { $('#input_3').val(evt.editor.getData()); }); 
                                        </script>

                                    </div>
                                </div>
                            </div>
                            <div class='row'>
                                <div class="col-lg-12">
                                    <div class="form-group">
                                        <label class="form-control-static pull-left"> Rate</label>
                                        <input type="number" class="form-control" id="input_2" name="rate" placeholder="Rate" value="<?php echo $data['rate']; ?>" required>
                                    </div>
                                </div>
                            </div>
                            <div class='row'>
                                <div class="col-lg-12">
                                    <div class="form-group">
                                        <label class="form-control-static pull-left"> Quantity</label>
                                        <input type="text" class="form-control" id="input_2" name="quantity" placeholder="Quantity" value="<?php echo $data['quantity']; ?>" required>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mbr-section-btn">
                            <div class="col-xs-12 col-sm-6 col-md-4 col-lg-4"><a href="view_invoice.php" class="col-xs-12 btn btn-lg btn-black-outline"><span class="fa fa-backward"></span>&nbsp;KEMBALI</a></div>
                            <div class="col-xs-12 col-sm-6 col-md-4 col-lg-4"><button type="submit" name="Update" class="col-xs-12 btn btn-lg btn-warning"><span class="fa fa-pencil"></span>&nbsp;EDIT DATA</button></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</form>

<?php $tinggi = '800px'; include('template/bottom.php') ?>


<?php 

include 'config/connect-db.php';

if(isset($_POST['Update'])) {

  // Memasukkan Data Inputan ke Varibael
  $id           = $_POST['id'];
  $kegiatan     = $_POST['kegiatan'];
  $item         = $_POST['item'];
  $description  = $_POST['description'];
  $rate         = $_POST['rate'];
  $quantity     = $_POST['quantity'];

   
      // Memasukkan data kedatabase berdasarakan variabel tadi
      $result = mysqli_query($mysqli, "UPDATE tb_invoice SET 
                                       kegiatan     =  '$kegiatan',
                                       item         =  '$item',
                                       description  =  '$description',
                                       rate         =  '$rate',
                                       quantity     =  '$quantity'
                                       WHERE id=$id");


  // Cek jika proses simpan ke database sukses atau tidak   
  if($result){ 
       // Jika Sukses, redirect halaman menggunakan javascript
      echo '<script language="javascript"> alert("Berhasil Edit Data!") </script>';
      echo '<script language="javascript"> window.location.href = "'.$base_url_back.'/view_invoice.php" </script>';
  }else{
      // Jika Gagal, Lakukan :
      echo "Maaf, Terjadi kesalahan saat mencoba untuk menyimpan data ke database.";
      //echo "<br><a href='tambah_tok.php'>Kembali Ke Form</a>";
  }


}

?>